/*C4*/SET SCHEMA PUBLIC
DROP TABLE IF EXISTS products CASCADE
DROP TABLE IF EXISTS orders CASCADE
DROP TABLE IF EXISTS order_items CASCADE
CREATE TABLE IF NOT EXISTS products (\u000a  id INT NOT NULL GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1),\u000a  name VARCHAR(45) not NULL,\u000a  price INT not NULL,\u000a  status VARCHAR(45) not NULL,\u000a  created_at datetime default CURRENT_TIMESTAMP,\u000a  CONSTRAINT PK_products PRIMARY KEY (id))
CREATE TABLE IF NOT EXISTS orders (\u000a  id INT NOT NULL GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1),\u000a  user_id INT,\u000a  status VARCHAR(45) NOT NULL,\u000a  created_at VARCHAR(45) NOT NULL,\u000a  CONSTRAINT PK_orders PRIMARY KEY (id)\u000a  )
CREATE TABLE IF NOT EXISTS order_items (\u000a  order_id INT NOT NULL,\u000a  product_id INT NOT NULL,\u000a  quantity INT DEFAULT 0,\u000a  CONSTRAINT PK_order_items PRIMARY KEY (order_id, product_id)\u000a)
ALTER TABLE order_items \u000aADD CONSTRAINT FK_products FOREIGN KEY (product_id) REFERENCES products(id)
ALTER TABLE order_items \u000aADD CONSTRAINT FK_orders FOREIGN KEY (order_id) REFERENCES orders(id)
GRANT "dbUserRole" TO "dbUser"
GRANT SELECT, UPDATE, INSERT ON TABLE order_items TO "dbUserRole"
GRANT SELECT, UPDATE, INSERT ON TABLE products TO "dbUserRole"
GRANT SELECT, UPDATE, INSERT ON TABLE orders TO "dbUserRole"
INSERT INTO PRODUCTS VALUES(1,'Spoon',1,'in_stock','2021-02-16 18:53:12.450000')
INSERT INTO PRODUCTS VALUES(2,'Fork',3,'in_stock','2021-02-16 18:53:12.450000')
INSERT INTO PRODUCTS VALUES(3,'Knife',5,'in_stock','2021-02-16 18:53:12.450000')
COMMIT
INSERT INTO ORDERS VALUES(1,1,'in_stock','2021-02-16 18:50:51.66')
INSERT INTO ORDERS VALUES(2,2,'in_stock','2021-02-16 18:50:51.66')
INSERT INTO ORDERS VALUES(3,3,'in_stock','2021-02-16 18:50:51.66')
COMMIT
INSERT INTO ORDER_ITEMS VALUES(1,1,10)
INSERT INTO ORDER_ITEMS VALUES(3,2,10)
INSERT INTO ORDER_ITEMS VALUES(3,3,10)
INSERT INTO ORDER_ITEMS VALUES(2,2,30)
INSERT INTO ORDER_ITEMS VALUES(2,3,20)
COMMIT
GRANT "dbRoleDelete" TO "dbDeleteUser"\u000a
GRANT SELECT, DELETE ON TABLE order_items TO "dbDeleteUser" \u000a
GRANT SELECT, DELETE ON TABLE products TO "dbDeleteUser"\u000a
GRANT SELECT, DELETE ON TABLE orders TO "dbDeleteUser"\u000a
DISCONNECT
